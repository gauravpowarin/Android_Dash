<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AndroDesk</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      width: 100vw;
      max-width: 100vh * (16 / 9);
      aspect-ratio: 16 / 9;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .flip-clock {
      display: flex;
      font-size: 4em;
      letter-spacing: 0.05em;
      margin-bottom: 0.5em;
    }

    .flip-unit {
      position: relative;
      margin: 0 5px;
      padding: 0.1em 0.3em;
      background: #1e1e1e;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5);
      text-align: center;
      min-width: 1.2em;
    }

    .date {
      font-size: 1.2em;
      color: #bbbbbb;
      margin-bottom: 1em;
    }

    .spotify {
      margin-top: 1em;
      text-align: center;
    }

    .login-btn, .fullscreen-btn {
      background-color: #1db954;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 1em;
      margin: 0.5em;
    }

    .now-playing {
      font-size: 1em;
      margin-top: 1em;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="flip-clock" id="clock"></div>
    <div class="date" id="date"></div>

    <div class="spotify">
      <button class="login-btn" id="login">Login with Spotify</button>
      <div class="now-playing" id="now-playing"></div>
    </div>

    <button class="fullscreen-btn" onclick="toggleFullscreen()">Fullscreen</button>
  </div>

  <script>
    // === CLOCK ===
    function pad(n) {
      return n < 10 ? '0' + n : n;
    }

    function updateClock() {
      const now = new Date();
      const hrs = pad(now.getHours());
      const mins = pad(now.getMinutes());
      const secs = pad(now.getSeconds());
      const day = now.toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: '2-digit', day: '2-digit' });

      document.getElementById('clock').innerHTML = `
        <div class="flip-unit">${hrs[0]}</div>
        <div class="flip-unit">${hrs[1]}</div>
        <div class="flip-unit">:</div>
        <div class="flip-unit">${mins[0]}</div>
        <div class="flip-unit">${mins[1]}</div>
        <div class="flip-unit">:</div>
        <div class="flip-unit">${secs[0]}</div>
        <div class="flip-unit">${secs[1]}</div>
      `;

      document.getElementById('date').textContent = day;
    }

    setInterval(updateClock, 1000);
    updateClock();

    // === FULLSCREEN ===
    function toggleFullscreen() {
      const doc = document.documentElement;
      if (!document.fullscreenElement) {
        doc.requestFullscreen().catch(err => alert(`Error attempting fullscreen: ${err.message}`));
      } else {
        document.exitFullscreen();
      }
    }

    // === SPOTIFY ===
    const clientId = '949feabab8594b5191db8234d960e6fe';
    const redirectUri = 'https://androdesk1.vercel.app/';
    const scopes = 'user-read-playback-state user-read-currently-playing';

    function getTokenFromHash() {
      const hash = window.location.hash;
      if (!hash) return null;
      const params = new URLSearchParams(hash.substring(1));
      const token = params.get('access_token');
      if (token) {
        localStorage.setItem('spotify_token', token);
        window.history.replaceState(null, null, window.location.pathname); // Clean up the hash
      }
      return token;
    }

    function getAccessToken() {
      return localStorage.getItem('spotify_token') || getTokenFromHash();
    }

    const accessToken = getAccessToken();

    if (accessToken) {
      document.getElementById('login').style.display = 'none';
      setInterval(fetchCurrentlyPlaying, 5000);
      fetchCurrentlyPlaying();
    }

    document.getElementById('login').onclick = () => {
      const authUrl = `https://accounts.spotify.com/authorize?response_type=token&client_id=${clientId}&scope=${encodeURIComponent(scopes)}&redirect_uri=${encodeURIComponent(redirectUri)}`;
      window.location.href = authUrl;
    };

    async function fetchCurrentlyPlaying() {
      const token = getAccessToken();
      if (!token) return;

      const res = await fetch('https://api.spotify.com/v1/me/player/currently-playing', {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });

      if (res.status === 204) {
        document.getElementById('now-playing').textContent = 'Nothing playing currently.';
        return;
      }

      if (!res.ok) {
        document.getElementById('now-playing').textContent = 'Error fetching playback info.';
        return;
      }

      const data = await res.json();
      if (data && data.item) {
        document.getElementById('now-playing').textContent = `Now Playing: ${data.item.name} - ${data.item.artists.map(a => a.name).join(', ')}`;
      }
    }
  </script>
</body>
</html>
